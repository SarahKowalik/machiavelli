<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Machiavelli by anchor</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Machiavelli</h1>
        <p class="header">Graphing and data visualization tool</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/anchor/machiavelli/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/anchor/machiavelli/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/anchor/machiavelli">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/anchor">anchor</a></p>


      </header>
      <section>
        <h1><a name="machiavelli" class="anchor" href="#machiavelli"><span class="octicon octicon-link"></span></a>Machiavelli</h1>

<p> Current status: <a href="https://travis-ci.org/anchor/machiavelli"><img src="https://travis-ci.org/anchor/machiavelli.png?branch=travis" alt="Build Status"></a> 
<a href='https://coveralls.io/r/anchor/machiavelli?branch=master'><img src='https://coveralls.io/repos/anchor/machiavelli/badge.png?branch=master' alt='Coverage Status' /></a>
</p>


<p>Machiavelli is a Ruby on Rails application for taking any arbitrarily defined data source, and feeding it into any arbitrarily defined graphing library.</p>

<h2>
	<a name="principles" class="anchor" href=#principles"><span class="octicon octicon-link"></span></a>Base Principles
</h2>

<blockquote>

<p>1) Show Machiavelli how to access a list of things, and how to get information about a specific thing from that list. That's it.</p>
<p>2) At any time, you should be able to copy the URL of a specific Machiavelli page, open it somewhere else, and get the exact same view of the data.</p>
<p>3) Any sufficiently configured Machiavelli instance should be able to be used to visualize any metric from the configured backends without any interaction at the server level.</p>
</blockquote>

</p>
<h2>
	<a name="components" class="anchor" href="#components"><span class="octicon octicon-link"></span></a>Components
</h2>

<h3>
	<a name="backends" class="anchor" href="#backends"><span class="octicon octicon-link"></span></a>Backends
</h3>

<p>A backend is defined as a thing that contains data, and information about what data it has. Per base princples, a backend must be sufficiently defined as to know how to: 
</p>

<ul>
<li>get a list of available metrics, and </li>
<li>get a data set for a particular metric</li>
</ul>

<p>Machiavelli currently has modules supporting the following backend types:</p>

<ul>
	<li><a href="https://github.com/anchor/vaultaire">Vaultaire</a>, via the <a href="https://github.com/anchor/descartes">Descartes</a> interface</li>
	<li><a href="https://github.com/graphite-project/graphite-web">Graphite</a></li>
	<li>"simple" RESTful interfaces</li>
	<li>csv flat files</li>
</ul>

<p>Additional backends can be easily created via extenions</p>

<h3>
	<a name="metrics" class="anchor" href="#graphs"><span class="octicon octicon-link"></span></a>Metrics
</h3>

<p>A metric is defined as an array or hash of points containing information about something over time. Any source that returns a series of <code>[time,value]</code> points can then be manipulated by a Machiavelli backend into a sufficiently standard format for graphing. </p>

<p>Metrics could be: the used space on a drive for a server over time, or the number of awake cows in a yard over a day. All graphs require a time series. Should a dataset return only values, assuming that the values start from a determined time and have a specific frequency (e.g. one datapoint per 10 seconds), then the backend can use this information to provide a <code>[time,value]</code> set for graphing. </p>


<h3>
	<a name="graphs" class="anchor" href="#graphs"><span class="octicon octicon-link"></span></a>Graphs
</h3>

<p>Once a metric source has been obtained and massaged into a standard format, it can be fed to a graph. This is done by a series of ruby classes, ERB views and javascript files in order to manipulate and display the data. </p>

<p>The type of graph being used to represent the selected metrics can be changed on the fly by the user via a simple series of buttons and toggles in the user interface.</p>

<p>Machiavelli current includes these graphing libraries:</p>

<ul>
	<li><a href="https://github.com/square/cubism">Cubism</a> (for horizon charts)</li>
	<li><a href="https://github.com/shutterstock/rickshaw">Rickshaw </a>(for standard, and stacked charts).</li>
</ul>

<h2>
	<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation
</h2>

<p>Ensure Ruby 1.9.3 or higher, and Redis are installed locally. Then, clone and execute like any standard Ruby on Rails application:</p>

<div class="highlight highlight-sh"><pre>git clone &lt;repo&gt;
bundle install
bundle <span class="nb">exec </span>rails server
</pre></div>

<p>The application can then be viewed at <code>http://localhost:3000</code>.</p>

<h3>
	<a name="testing-data-source" class="anchor" href="#testing-data-source"><span class="octicon octicon-link"></span></a>Testing Data source
</h3>

<p>The default configuration settings include a simple data source, an itty bitty Sinatra application that can be run along side a default installation of Machiavelli to demo the application. Run this by executing:</p>

<div class="highlight highlight-sh"><pre>
ruby simple_endpoint.rb
</pre></div>

<p>The endpoint itself is then accessible at <code>http://localhost:4567</code> (the standard Sinatra path)</p>

<p>Then, just navigate to the running Machiavelli instance, <code>http://localhost:3000</code>, and you're on your way.</p>

<p>For testing flatfiles, run <code>generate_flatfile.rb</code> and reference the file in <code>public/flatfile.csv</code></p>

<h2>
	<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage
</h2>

<p>Once at the Machiavelli page, the navigation is intuiative. The interface is very plain until a metric is selected, using the 'Search' button.</p>

<p>Metrics are listed either by a live json feed, or via a cached list, defined per backend. </p>

<p>After selecting, a number of options relating to the time range being queried, the graphing option being used, and other elements, can be changed via the various toggles and buttons in the navigation bar</p>

<h2>
	<a name="url" class="anchor" href="#url"><span class="octicon octicon-link"></span></a>The URL
</h2>

<p>Per the base principles, Machiavelli adheres to is the 'stickiess' of it's URL. Any generated URL should be able to be sent to someone else to get the same view of the data (given they have access to the main server).</p>

<p>The user interface in Machiavelli is mostly used to generate this URL. The ruby and javascript parts then take bits of the URL to create the visualization</p>

<h3>
	Sudo make me a URL
</h3>

<p>The Machiavelli URL can be generated manually. It adheres to the following specification: </p>

<p>Assuming the hostname is <code>http://hostname.com/</code>, then ...</p>

<code>/?[metric][paramters]</code>
<ul>
	<li><code>metric</code> - in the form <code>backend~metric</code> per <code>/source/</code></li>
	<li>Optional</li>
<ul>
	<li><code>start</code> - the start time for a metric. Default: 3 hours ago. Format: seconds since epoch, or "nice time"</li>
	<li><code>stop</code> - the stop time for a metric. Default: now. Format: seconds since epoch, or "nice time", or <code>now</code></li>
	<li><code>step</code> - the "stride" between points. Default: the step between start and stop that will return 600 datapoints. </li>
	<li><code>time</code> - the time format to the used - <code>relative</code> or <code>absolute</code> (UI default). Default: relative. </li>
	<li><code>graph</code> - the graphing module to be used - <code>standard</code>, <code>stacked</code>, or <code>horizon</code>. Default: standard</li>
</ul>
</ul>
<p>"nice time" is in the format [INT][w|d|h|min] (week, day, hour, minute) e.g. <code>3h</code> -&gt; 3 hours</p>

<code>/metric/?[metric][params]</code>
<ul>
	<li><code>metric</code> - see <code>/</code></li>
	<li><code>start/stop/step</code> - see <code>/</code></li>
</ul>

<code>/source/</code> - lists all available sources
<ul>
<li><code>backend</code> - (Optional). Allows you to list metrics from one backend source only</li>
</ul>


<h2>
	<a name="invoking-backends" class="anchor" href="#invoking-backends"><span class="octicon octicon-link"></span></a>Invoking Backends
</h2>

<p>Adding a backend to a Machiavelli instance is as simple as adding it to the <code>backends</code> stanza in <code>config/settings.yml</code>.</p>

<p>By default, every backend requires:</p>

<ul>
<li>
<code>type</code> 

<ul>
<li>the name of the library in <code>lib/backend/</code> to be invoked</li>
</ul>
</li>
<li>
<code>settings</code> 

<ul>
<li>a hash of settings to pass to the library. See each library for details.</li>
</ul>
</li>
</ul><p>Multiple backends of the same type can be invoked at once by adding an <code>alias</code> setting. The backend type, or alias (if used), will appear in the metrics listing in Machiavelli.</p>

<h2>
<a name="creating-new-backends" class="anchor" href="#creating-new-backends"><span class="octicon octicon-link"></span></a>Creating New Backends</h2>

<p>New backends can be defined by copying the simple backend as a template. In addition, the functions within the parent <code>Backend::GenericBackend</code> class marked as <code>NotImplemented</code> should be included in the child class.</p>

<h2>
<a name="optional-settings" class="anchor" href="#optional-settings"><span class="octicon octicon-link"></span></a>Optional Settings</h2>

<p>Machiavelli will accept any <code>config/settings.yml</code> overwrites of the following values:</p>

<p><code>tooltips</code></p>

<ul>
<li>default <code>off</code>.</li>
<li>Set to true for tooltips for the basic user interface</li>
</ul><p><code>horizon_color</code></p>

<ul>
<li> default <code>#006d2c</code> ("Cubism" green).</li>
<li>Set a base colour for the darkest horizon colouring.</li>
</ul><p><code>redis_host</code>,<code>redis_port</code></p>

<ul>
<li> default <code>127.0.0.1</code>, <code>6379</code> </li>
<li>Set an alternative redis server for metrics caching.</li>
</ul><p><code>metrics_key</code></p>

<ul>
<li> default <code>Machiavelli.Backend.Metrics</code> </li>
<li>Set a base key for metric name caching in Redis.</li>
</ul><h2>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<p>Machiavelli makes use of the following projects and code libraries under their associated licences:</p>

<ul>
<li>
<a href="https://github.com/shutterstock/rickshaw">Rickshaw</a> by <a href="http://www.shutterstock.com">Shutterstock</a>, available under the MIT Licence.

<ul>
<li>our fork is available <a href="https://github.com/glasnt/rickshaw">here</a>
</li>
</ul>
</li>
<li>
<a href="https://github.com/square/cubism">Cubism</a> by <a href="http://square.github.io/">Square</a>, available under the Apache 2.0 Licence.

<ul>
<li>our fork is available <a href="https://github.com/glasnt/cubism">here</a>
</li>
</ul>
</li>
<li>
<a href="https://github.com/mbostock/d3">D3</a> by <a href="http://bost.ocks.org/mike/">Mike Bostock</a>, available under the BSD3 Licence.

<ul>
<li>our fork is available <a href="https://github.com/glasnt/d3">here</a>
</li>
</ul>
</li>
<li>
<a href="https://github.com/IronSummitMedia/startbootstrap/tree/master/templates/sb-admin-v2">SBAdmin2 Theme</a> by <a href="http://www.ironsummitmedia.com/">Iron Summit Media</a>, available under the Apache 2.0 Licence.</li>
<ul>
<li>our fork is available <a href="https://github.com/glasnt/startbootstrap">here</a>
</li>
</ul>
</li>
<li>
<a href="https://github.com/twbs/bootstrap/">Bootstrap</a> by <a href="https://twitter.com">Twitter</a>, available under the MIT Licence.</li>
<li>
<a href="https://github.com/jquery/jquery">jQuery</a>, available under the MIT Licence.</li>
<li>
<a href="https://github.com/ivaynberg/select2">select2</a> by <a href="https://github.com/ivaynberg">Igor Vaynberg</a>, available under the Apache 2.0 Licence.</li>
<li>
<a href="https://github.com/FortAwesome/Font-Awesome/">Font Awesome</a>, by Dave Gandy - <a href="http://fontawesome.io">http://fontawesome.io</a>
</li>
</ul><p>Machiavelli is written in <a href="https://github.com/rails/rails">Ruby on Rails</a>, licensed under the MIT Licence.</p>

<h2>
<a name="licence" class="anchor" href="#licence"><span class="octicon octicon-link"></span></a>Licence</h2>

<p>Machiavelli is available under a BSD3 licence, see <a href="LICENCE">LICENCE</a> for more information.</p>

<p>For dependent libraries, see the Dependencies section of this file.</p>

<p><a href="https://github.com/graphite-project/">Graphite</a> is available under the Apache 2.0 Licence.</p>

<p><a href="https://github.com/antirez/redis">Redis</a> is available under a BSD3 Licence.</p>
</section>
      <footer>
	      <hr>
	      <p style="font-size: small"><span style="font-style:oblique">Before all else, be graphed</span> -- Machiavelli (apocryphal)</p>
	      <hr>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
